<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>schulcloud-server documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">schulcloud-server documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li>Injectables</li>
  <li >AuthorisationUtils</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>apps/server/src/shared/domain/rules/authorisation.utils.ts</code>
        </p>





            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#checkAllPermissions" >checkAllPermissions</a>
                            </li>
                            <li>
                                <a href="#checkOneOfPermissions" >checkOneOfPermissions</a>
                            </li>
                            <li>
                                <a href="#checkSameSchool" >checkSameSchool</a>
                            </li>
                            <li>
                                <a href="#hasAccessToEntity" >hasAccessToEntity</a>
                            </li>
                            <li>
                                <a href="#hasAllPermissions" >hasAllPermissions</a>
                            </li>
                            <li>
                                <a href="#hasOneOfPermissions" >hasOneOfPermissions</a>
                            </li>
                            <li>
                                <a href="#hasRole" >hasRole</a>
                            </li>
                            <li>
                                <a href="#isSameSchool" >isSameSchool</a>
                            </li>
                            <li>
                                <a href="#resolvePermissions" >resolvePermissions</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#resolvePermissionsByRoles" >resolvePermissionsByRoles</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>


            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkAllPermissions"></a>
                    <span class="name">
                        <span ><b>checkAllPermissions</b></span>
                        <a href="#checkAllPermissions"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>checkAllPermissions(user: <a href="../interfaces/User.html" target="_self">User</a>, requiredPermissions: string[])</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="56"
                            class="link-to-prism">apps/server/src/shared/domain/rules/authorisation.utils.ts:56</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../interfaces/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>requiredPermissions</td>
                                    <td>
                                            <code>string[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkOneOfPermissions"></a>
                    <span class="name">
                        <span ><b>checkOneOfPermissions</b></span>
                        <a href="#checkOneOfPermissions"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>checkOneOfPermissions(user: <a href="../interfaces/User.html" target="_self">User</a>, requiredPermissions: string[])</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="75"
                            class="link-to-prism">apps/server/src/shared/domain/rules/authorisation.utils.ts:75</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../interfaces/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>requiredPermissions</td>
                                    <td>
                                            <code>string[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkSameSchool"></a>
                    <span class="name">
                        <span ><b>checkSameSchool</b></span>
                        <a href="#checkSameSchool"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>checkSameSchool(user: <a href="../interfaces/User.html" target="_self">User</a>, entity: <a href="../interfaces/IEntityWithSchool.html" target="_self">IEntityWithSchool</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="118"
                            class="link-to-prism">apps/server/src/shared/domain/rules/authorisation.utils.ts:118</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../interfaces/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>entity</td>
                                    <td>
                                                <code><a href="../interfaces/IEntityWithSchool.html" target="_self" >IEntityWithSchool</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hasAccessToEntity"></a>
                    <span class="name">
                        <span ><b>hasAccessToEntity</b></span>
                        <a href="#hasAccessToEntity"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>hasAccessToEntity(user: <a href="../interfaces/User.html" target="_self">User</a>, entity: T, userRefProps: K[])</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="94"
                            class="link-to-prism">apps/server/src/shared/domain/rules/authorisation.utils.ts:94</a></div>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <b>Type parameters :</b>
                    <ul class="type-parameters">
                        <li>T</li>
                        <li>K</li>
                    </ul>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Determines whether a user has access to the specified entity by reference props.</p>
<div><pre class="line-numbers"><code class="language-html">const user = new User({id: 1})
const entity = new News({id:2, creator: user})
const userRefProps = [&#39;creator&#39;]</code></pre></div><p>@param user a user
@param entity An entity to access
@param userRefProps Array of properties in the entity the user is associated with
@returns
```</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../interfaces/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>a user</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>entity</td>
                                    <td>
                                            <code>T</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>An entity to access</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>userRefProps</td>
                                    <td>
                                            <code>K[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>Array of properties in the entity the user is associated with</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                        <b>Example :</b>
                        <div>
                            <pre class="line-numbers"><code class="language-html">&lt;pre&gt;&lt;code&gt;const user = new User({id: 1})
const entity = new News({id:2, creator: user})
const userRefProps = [&amp;#39;creator&amp;#39;]
&lt;/code&gt;&lt;/pre&gt;</code></pre>
                        </div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hasAllPermissions"></a>
                    <span class="name">
                        <span ><b>hasAllPermissions</b></span>
                        <a href="#hasAllPermissions"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>hasAllPermissions(user: <a href="../interfaces/User.html" target="_self">User</a>, requiredPermissions: string[])</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="44"
                            class="link-to-prism">apps/server/src/shared/domain/rules/authorisation.utils.ts:44</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../interfaces/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>requiredPermissions</td>
                                    <td>
                                            <code>string[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hasOneOfPermissions"></a>
                    <span class="name">
                        <span ><b>hasOneOfPermissions</b></span>
                        <a href="#hasOneOfPermissions"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>hasOneOfPermissions(user: <a href="../interfaces/User.html" target="_self">User</a>, requiredPermissions: string[])</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="63"
                            class="link-to-prism">apps/server/src/shared/domain/rules/authorisation.utils.ts:63</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../interfaces/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>requiredPermissions</td>
                                    <td>
                                            <code>string[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hasRole"></a>
                    <span class="name">
                        <span ><b>hasRole</b></span>
                        <a href="#hasRole"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>hasRole(user: <a href="../interfaces/User.html" target="_self">User</a>, roleName: <a href="../interfaces/User.html" target="_self">IUserRoleName</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="129"
                            class="link-to-prism">apps/server/src/shared/domain/rules/authorisation.utils.ts:129</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Please not use role instead of permission. It is only for do something for target if it has the role xy.
For each other operations please define, use the string based permissions inside the roles.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../interfaces/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>roleName</td>
                                    <td>
                                                <code><a href="../interfaces/User.html" target="_self" >IUserRoleName</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isSameSchool"></a>
                    <span class="name">
                        <span ><b>isSameSchool</b></span>
                        <a href="#isSameSchool"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>isSameSchool(user: <a href="../interfaces/User.html" target="_self">User</a>, entity: <a href="../interfaces/IEntityWithSchool.html" target="_self">IEntityWithSchool</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="111"
                            class="link-to-prism">apps/server/src/shared/domain/rules/authorisation.utils.ts:111</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../interfaces/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>entity</td>
                                    <td>
                                                <code><a href="../interfaces/IEntityWithSchool.html" target="_self" >IEntityWithSchool</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="resolvePermissions"></a>
                    <span class="name">
                        <span ><b>resolvePermissions</b></span>
                        <a href="#resolvePermissions"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>resolvePermissions(user: <a href="../interfaces/User.html" target="_self">User</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="13"
                            class="link-to-prism">apps/server/src/shared/domain/rules/authorisation.utils.ts:13</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Recursively resolve all roles and permissions of a user.
IMPORTANT: The role collections of the user and nested roles will not be loaded lazily.
Please make sure you populate them before calling this method.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../interfaces/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>string[]</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="resolvePermissionsByRoles"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>resolvePermissionsByRoles</b></span>
                        <a href="#resolvePermissionsByRoles"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>resolvePermissionsByRoles(inputRoles: <a href="../entitys/Role.html" target="_self">Role[]</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="22"
                            class="link-to-prism">apps/server/src/shared/domain/rules/authorisation.utils.ts:22</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>inputRoles</td>
                                    <td>
                                                <code><a href="../entitys/Role.html" target="_self" >Role[]</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>string[]</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Collection } from &#x27;@mikro-orm/core&#x27;;
import { Injectable, UnauthorizedException } from &#x27;@nestjs/common&#x27;;
import { Role, User } from &#x27;@shared/domain/entity&#x27;;
import { IEntityWithSchool, IUserRoleName } from &#x27;../interface&#x27;;

@Injectable()
export class AuthorisationUtils {
	/**
	 * Recursively resolve all roles and permissions of a user.
	 * IMPORTANT: The role collections of the user and nested roles will not be loaded lazily.
	 * Please make sure you populate them before calling this method.
	 */
	resolvePermissions(user: User): string[] {
		if (!user.roles.isInitialized(true)) {
			throw new Error(&#x27;Roles items are not loaded.&#x27;);
		}
		const rolesAndPermissions &#x3D; this.resolvePermissionsByRoles(user.roles.getItems());

		return rolesAndPermissions;
	}

	private resolvePermissionsByRoles(inputRoles: Role[]): string[] {
		let permissions: string[] &#x3D; [];

		for (let i &#x3D; 0; i &lt; inputRoles.length; i +&#x3D; 1) {
			const role &#x3D; inputRoles[i];
			if (!role.roles.isInitialized(true)) {
				throw new Error(&#x27;Roles items are not loaded.&#x27;);
			}
			const innerRoles &#x3D; role.roles.getItems();
			permissions &#x3D; [...permissions, ...role.permissions];

			if (innerRoles.length &gt; 0) {
				const subPermissions &#x3D; this.resolvePermissionsByRoles(innerRoles);
				permissions &#x3D; [...permissions, ...subPermissions];
			}
		}

		permissions &#x3D; [...new Set(permissions)];

		return permissions;
	}

	hasAllPermissions(user: User, requiredPermissions: string[]): boolean {
		if (requiredPermissions.length &#x3D;&#x3D;&#x3D; 0) {
			return true;
		}
		const usersPermissions &#x3D; this.resolvePermissions(user);
		const hasPermissions &#x3D; requiredPermissions.every((p) &#x3D;&gt; usersPermissions.includes(p));
		return hasPermissions;
	}

	/**
	 * @throws UnauthorizedException
	 */
	checkAllPermissions(user: User, requiredPermissions: string[]): void {
		const hasPermission &#x3D; this.hasAllPermissions(user, requiredPermissions);
		if (hasPermission !&#x3D;&#x3D; true) {
			throw new UnauthorizedException();
		}
	}

	hasOneOfPermissions(user: User, requiredPermissions: string[]): boolean {
		if (!Array.isArray(requiredPermissions) || requiredPermissions.length &#x3D;&#x3D;&#x3D; 0) {
			return false;
		}
		const permissions &#x3D; this.resolvePermissions(user);
		const hasPermission &#x3D; requiredPermissions.some((p) &#x3D;&gt; permissions.includes(p));
		return hasPermission;
	}

	/**
	 * @throws UnauthorizedException
	 */
	checkOneOfPermissions(user: User, requiredPermissions: string[]): void {
		const hasPermission &#x3D; this.hasOneOfPermissions(user, requiredPermissions);
		if (hasPermission !&#x3D;&#x3D; true) {
			throw new UnauthorizedException();
		}
	}

	/**
	 * Determines whether a user has access to the specified entity by reference props.
	 * @example &#x60;&#x60;&#x60;
	 * const user &#x3D; new User({id: 1})
	 * const entity &#x3D; new News({id:2, creator: user})
	 * const userRefProps &#x3D; [&#x27;creator&#x27;]
	 * &#x60;&#x60;&#x60;
	 * @param user a user
	 * @param entity An entity to access
	 * @param userRefProps Array of properties in the entity the user is associated with
	 * @returns
	 */
	hasAccessToEntity&lt;T, K extends keyof T&gt;(user: User, entity: T, userRefProps: K[]) {
		const res &#x3D; userRefProps.some((prop) &#x3D;&gt; {
			const reference &#x3D; entity[prop];
			if (reference instanceof Collection) {
				return reference.contains(user);
			}
			if (reference instanceof User) {
				return reference &#x3D;&#x3D;&#x3D; user;
			}
			return (reference as unknown as string) &#x3D;&#x3D;&#x3D; user.id;
		});

		return res;
	}

	// todo: hasAccessToDomainObject

	isSameSchool(user: User, entity: IEntityWithSchool) {
		return user.school &#x3D;&#x3D;&#x3D; entity.school;
	}

	/**
	 * @throws UnauthorizedException
	 */
	checkSameSchool(user: User, entity: IEntityWithSchool) {
		const isSameSchool &#x3D; this.isSameSchool(user, entity);
		if (isSameSchool !&#x3D;&#x3D; true) {
			throw new UnauthorizedException();
		}
	}

	/**
	 * Please not use role instead of permission. It is only for do something for target if it has the role xy.
	 * For each other operations please define, use the string based permissions inside the roles.
	 */
	hasRole(user: User, roleName: IUserRoleName) {
		if (!user.roles.isInitialized(true)) {
			throw new Error(&#x27;Roles items are not loaded.&#x27;);
		}
		return user.roles.getItems().some((role) &#x3D;&gt; {
			return role.name &#x3D;&#x3D;&#x3D; roleName;
		});
	}
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'AuthorisationUtils.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
