<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>schulcloud-server documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">schulcloud-server documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li>Injectables</li>
  <li >AccountUc</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>apps/server/src/modules/account/uc/account.uc.ts</code>
        </p>





            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#checkBrutForce" >checkBrutForce</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#checkPassword" >checkPassword</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#checkUniqueEmail" >checkUniqueEmail</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#deleteAccountById" >deleteAccountById</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#extractRoles" >extractRoles</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findAccountById" >findAccountById</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#hasPermissionsToAccessAccount" >hasPermissionsToAccessAccount</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#hasPermissionsToChangeOwnName" >hasPermissionsToChangeOwnName</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#hasRole" >hasRole</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#isSuperhero" >isSuperhero</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#replaceMyTemporaryPassword" >replaceMyTemporaryPassword</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#saveAccount" >saveAccount</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#schoolPermissionExists" >schoolPermissionExists</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#searchAccounts" >searchAccounts</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateAccountById" >updateAccountById</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateMyAccount" >updateMyAccount</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(accountService: <a href="../injectables/AccountService.html" target="_self">AccountService</a>, userRepo: <a href="../injectables/UserRepo.html" target="_self">UserRepo</a>, permissionService: <a href="../injectables/PermissionService.html" target="_self">PermissionService</a>, accountValidationService: <a href="../injectables/AccountValidationService.html" target="_self">AccountValidationService</a>, configService: <a href="../interfaces/IAccountConfig.html" target="_self">ConfigService&lt;IAccountConfig | &gt;</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="47" class="link-to-prism">apps/server/src/modules/account/uc/account.uc.ts:47</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>accountService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/AccountService.html" target="_self" >AccountService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userRepo</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/UserRepo.html" target="_self" >UserRepo</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>permissionService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/PermissionService.html" target="_self" >PermissionService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>accountValidationService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/AccountValidationService.html" target="_self" >AccountValidationService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>configService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../interfaces/IAccountConfig.html" target="_self" >ConfigService&lt;IAccountConfig | &gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkBrutForce"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>checkBrutForce</b></span>
                        <a href="#checkBrutForce"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>checkBrutForce(username: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, systemId: <a href="../undefineds/EntityId.html" target="_self">EntityId | ObjectId</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="348"
                            class="link-to-prism">apps/server/src/modules/account/uc/account.uc.ts:348</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>username</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>systemId</td>
                                    <td>
                                                <code><a href="../miscellaneous/typealiases.html#EntityId" target="_self" >EntityId | ObjectId</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkPassword"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span class="modifier">Async</span>
                        <span ><b>checkPassword</b></span>
                        <a href="#checkPassword"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>checkPassword(enteredPassword: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, hashedAccountPassword: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="478"
                            class="link-to-prism">apps/server/src/modules/account/uc/account.uc.ts:478</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>enteredPassword</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>hashedAccountPassword</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkUniqueEmail"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span class="modifier">Async</span>
                        <span ><b>checkUniqueEmail</b></span>
                        <a href="#checkUniqueEmail"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>checkUniqueEmail(account: <a href="../classes/AccountDto.html" target="_self">AccountDto</a>, user: <a href="../interfaces/User.html" target="_self">User</a>, email: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="364"
                            class="link-to-prism">apps/server/src/modules/account/uc/account.uc.ts:364</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>account</td>
                                    <td>
                                                <code><a href="../classes/AccountDto.html" target="_self" >AccountDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../interfaces/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>email</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="deleteAccountById"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>deleteAccountById</b></span>
                        <a href="#deleteAccountById"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>deleteAccountById(currentUser: <a href="../interfaces/ICurrentUser.html" target="_self">ICurrentUser</a>, params: <a href="../classes/AccountByIdParams.html" target="_self">AccountByIdParams</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="219"
                            class="link-to-prism">apps/server/src/modules/account/uc/account.uc.ts:219</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>This method processes the request on the DELETE account with id endpoint from the account controller.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>currentUser</td>
                                    <td>
                                                <code><a href="../interfaces/ICurrentUser.html" target="_self" >ICurrentUser</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>the request user</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>params</td>
                                    <td>
                                                <code><a href="../classes/AccountByIdParams.html" target="_self" >AccountByIdParams</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>the request parameters</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../entitys/Account.html" target="_self" >Promise&lt;AccountResponse&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="extractRoles"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>extractRoles</b></span>
                        <a href="#extractRoles"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>extractRoles(inputRoles: <a href="../entitys/Role.html" target="_self">Role[]</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="465"
                            class="link-to-prism">apps/server/src/modules/account/uc/account.uc.ts:465</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>inputRoles</td>
                                    <td>
                                                <code><a href="../entitys/Role.html" target="_self" >Role[]</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>string[]</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findAccountById"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>findAccountById</b></span>
                        <a href="#findAccountById"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findAccountById(currentUser: <a href="../interfaces/ICurrentUser.html" target="_self">ICurrentUser</a>, params: <a href="../classes/AccountByIdParams.html" target="_self">AccountByIdParams</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="104"
                            class="link-to-prism">apps/server/src/modules/account/uc/account.uc.ts:104</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>This method processes the request on the GET account with id endpoint from the account controller.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>currentUser</td>
                                    <td>
                                                <code><a href="../interfaces/ICurrentUser.html" target="_self" >ICurrentUser</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>the request user</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>params</td>
                                    <td>
                                                <code><a href="../classes/AccountByIdParams.html" target="_self" >AccountByIdParams</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>the request parameters</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../entitys/Account.html" target="_self" >Promise&lt;AccountResponse&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hasPermissionsToAccessAccount"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>hasPermissionsToAccessAccount</b></span>
                        <a href="#hasPermissionsToAccessAccount"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>hasPermissionsToAccessAccount(currentUser: <a href="../interfaces/User.html" target="_self">User</a>, targetUser: <a href="../interfaces/User.html" target="_self">User</a>, action: "READ" | "UPDATE" | "DELETE" | "CREATE")</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="387"
                            class="link-to-prism">apps/server/src/modules/account/uc/account.uc.ts:387</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>currentUser</td>
                                    <td>
                                                <code><a href="../interfaces/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>targetUser</td>
                                    <td>
                                                <code><a href="../interfaces/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>action</td>
                                    <td>
                                            <code>&quot;READ&quot; | &quot;UPDATE&quot; | &quot;DELETE&quot; | &quot;CREATE&quot;</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hasPermissionsToChangeOwnName"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>hasPermissionsToChangeOwnName</b></span>
                        <a href="#hasPermissionsToChangeOwnName"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>hasPermissionsToChangeOwnName(currentUser: <a href="../interfaces/User.html" target="_self">User</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="379"
                            class="link-to-prism">apps/server/src/modules/account/uc/account.uc.ts:379</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>currentUser</td>
                                    <td>
                                                <code><a href="../interfaces/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hasRole"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>hasRole</b></span>
                        <a href="#hasRole"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>hasRole(user: <a href="../interfaces/User.html" target="_self">User</a>, roleName: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="370"
                            class="link-to-prism">apps/server/src/modules/account/uc/account.uc.ts:370</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../interfaces/User.html" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>roleName</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isSuperhero"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span class="modifier">Async</span>
                        <span ><b>isSuperhero</b></span>
                        <a href="#isSuperhero"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>isSuperhero(currentUser: <a href="../interfaces/ICurrentUser.html" target="_self">ICurrentUser</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="374"
                            class="link-to-prism">apps/server/src/modules/account/uc/account.uc.ts:374</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>currentUser</td>
                                    <td>
                                                <code><a href="../interfaces/ICurrentUser.html" target="_self" >ICurrentUser</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="replaceMyTemporaryPassword"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>replaceMyTemporaryPassword</b></span>
                        <a href="#replaceMyTemporaryPassword"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>replaceMyTemporaryPassword(userId: <a href="../undefineds/EntityId.html" target="_self">EntityId</a>, password: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, confirmPassword: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="303"
                            class="link-to-prism">apps/server/src/modules/account/uc/account.uc.ts:303</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>This method is used to replace my (currentUser) temporary password.
Callable when the current user&#39;s password was force set or this is the first login.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="../miscellaneous/typealiases.html#EntityId" target="_self" >EntityId</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>the current user</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>password</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>the new password</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>confirmPassword</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>the new password (has to match password)</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="saveAccount"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>saveAccount</b></span>
                        <a href="#saveAccount"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>saveAccount(dto: <a href="../classes/AccountSaveDto.html" target="_self">AccountSaveDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="112"
                            class="link-to-prism">apps/server/src/modules/account/uc/account.uc.ts:112</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>dto</td>
                                    <td>
                                                <code><a href="../classes/AccountSaveDto.html" target="_self" >AccountSaveDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="schoolPermissionExists"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>schoolPermissionExists</b></span>
                        <a href="#schoolPermissionExists"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>schoolPermissionExists(roles: string[], school: <a href="../classes/School.html" target="_self">School</a>, permissions: string[])</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="453"
                            class="link-to-prism">apps/server/src/modules/account/uc/account.uc.ts:453</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>roles</td>
                                    <td>
                                            <code>string[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>school</td>
                                    <td>
                                                <code><a href="../classes/School.html" target="_self" >School</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>permissions</td>
                                    <td>
                                            <code>string[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="searchAccounts"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>searchAccounts</b></span>
                        <a href="#searchAccounts"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>searchAccounts(currentUser: <a href="../interfaces/ICurrentUser.html" target="_self">ICurrentUser</a>, query: <a href="../classes/AccountSearchQueryParams.html" target="_self">AccountSearchQueryParams</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="64"
                            class="link-to-prism">apps/server/src/modules/account/uc/account.uc.ts:64</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>This method processes the request on the GET account search endpoint from the account controller.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>currentUser</td>
                                    <td>
                                                <code><a href="../interfaces/ICurrentUser.html" target="_self" >ICurrentUser</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>the request user</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>query</td>
                                    <td>
                                                <code><a href="../classes/AccountSearchQueryParams.html" target="_self" >AccountSearchQueryParams</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>the request query</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../entitys/Account.html" target="_self" >Promise&lt;AccountSearchListResponse&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateAccountById"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateAccountById</b></span>
                        <a href="#updateAccountById"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateAccountById(currentUser: <a href="../interfaces/ICurrentUser.html" target="_self">ICurrentUser</a>, params: <a href="../classes/AccountByIdParams.html" target="_self">AccountByIdParams</a>, body: <a href="../classes/AccountByIdBodyParams.html" target="_self">AccountByIdBodyParams</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="155"
                            class="link-to-prism">apps/server/src/modules/account/uc/account.uc.ts:155</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>This method processes the request on the PATCH account with id endpoint from the account controller.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>currentUser</td>
                                    <td>
                                                <code><a href="../interfaces/ICurrentUser.html" target="_self" >ICurrentUser</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>the request user</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>params</td>
                                    <td>
                                                <code><a href="../classes/AccountByIdParams.html" target="_self" >AccountByIdParams</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>the request parameters</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>body</td>
                                    <td>
                                                <code><a href="../classes/AccountByIdBodyParams.html" target="_self" >AccountByIdBodyParams</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>the request body</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../entitys/Account.html" target="_self" >Promise&lt;AccountResponse&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateMyAccount"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateMyAccount</b></span>
                        <a href="#updateMyAccount"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateMyAccount(currentUserId: <a href="../undefineds/EntityId.html" target="_self">EntityId</a>, params: <a href="../classes/PatchMyAccountParams.html" target="_self">PatchMyAccountParams</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="234"
                            class="link-to-prism">apps/server/src/modules/account/uc/account.uc.ts:234</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>This method allows to update my (currentUser) account details.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>currentUserId</td>
                                    <td>
                                                <code><a href="../miscellaneous/typealiases.html#EntityId" target="_self" >EntityId</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>the current user</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>params</td>
                                    <td>
                                                <code><a href="../classes/PatchMyAccountParams.html" target="_self" >PatchMyAccountParams</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>account details</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &#x27;@nestjs/common&#x27;;
import { ConfigService } from &#x27;@nestjs/config&#x27;;
import {
	AuthorizationError,
	EntityNotFoundError,
	ForbiddenOperationError,
	ValidationError,
} from &#x27;@shared/common/error&#x27;;
import {
	Account,
	EntityId,
	ICurrentUser,
	Permission,
	PermissionService,
	Role,
	RoleName,
	School,
	User,
} from &#x27;@shared/domain&#x27;;
import { UserRepo } from &#x27;@shared/repo&#x27;;
import { AccountService } from &#x27;@src/modules/account/services/account.service&#x27;;
import { AccountDto } from &#x27;@src/modules/account/services/dto/account.dto&#x27;;
import bcrypt from &#x27;bcryptjs&#x27;;
import { isEmail, validateOrReject } from &#x27;class-validator&#x27;;

import { BruteForcePrevention } from &#x27;@src/imports-from-feathers&#x27;;
import { ObjectId } from &#x27;bson&#x27;;
import { IAccountConfig } from &#x27;../account-config&#x27;;
import {
	AccountByIdBodyParams,
	AccountByIdParams,
	AccountResponse,
	AccountSearchListResponse,
	AccountSearchQueryParams,
	AccountSearchType,
	PatchMyAccountParams,
} from &#x27;../controller/dto&#x27;;
import { AccountResponseMapper } from &#x27;../mapper&#x27;;
import { AccountValidationService } from &#x27;../services/account.validation.service&#x27;;
import { AccountSaveDto } from &#x27;../services/dto&#x27;;

type UserPreferences &#x3D; {
	// first login completed
	firstLogin: boolean;
};
@Injectable()
export class AccountUc {
	constructor(
		private readonly accountService: AccountService,
		private readonly userRepo: UserRepo,
		private readonly permissionService: PermissionService,
		private readonly accountValidationService: AccountValidationService,
		private readonly configService: ConfigService&lt;IAccountConfig, true&gt;
	) {}

	/**
	 * This method processes the request on the GET account search endpoint from the account controller.
	 *
	 * @param currentUser the request user
	 * @param query the request query
	 * @throws {ValidationError}
	 * @throws {ForbiddenOperationError}
	 */
	async searchAccounts(currentUser: ICurrentUser, query: AccountSearchQueryParams): Promise&lt;AccountSearchListResponse&gt; {
		const skip &#x3D; query.skip ?? 0;
		const limit &#x3D; query.limit ?? 10;
		const executingUser &#x3D; await this.userRepo.findById(currentUser.userId, true);

		if (query.type &#x3D;&#x3D;&#x3D; AccountSearchType.USERNAME) {
			if (!(await this.isSuperhero(currentUser))) {
				throw new ForbiddenOperationError(&#x27;Current user is not authorized to search for accounts.&#x27;);
			}
			// eslint-disable-next-line no-case-declarations
			const { accounts, total } &#x3D; await this.accountService.searchByUsernamePartialMatch(query.value, skip, limit);
			// eslint-disable-next-line no-case-declarations
			const accountList &#x3D; accounts.map((tempAccount) &#x3D;&gt; AccountResponseMapper.mapToResponse(tempAccount));
			return new AccountSearchListResponse(accountList, total, skip, limit);
		}
		if (query.type &#x3D;&#x3D;&#x3D; AccountSearchType.USER_ID) {
			const targetUser &#x3D; await this.userRepo.findById(query.value, true);
			const permission &#x3D; this.hasPermissionsToAccessAccount(executingUser, targetUser, &#x27;READ&#x27;);

			if (!permission) {
				throw new ForbiddenOperationError(&#x27;Current user is not authorized to search for accounts by user id.&#x27;);
			}
			const account &#x3D; await this.accountService.findByUserId(query.value);
			if (account) {
				return new AccountSearchListResponse([AccountResponseMapper.mapToResponse(account)], 1, 0, 1);
			}
			return new AccountSearchListResponse([], 0, 0, 0);
		}

		throw new ValidationError(&#x27;Invalid search type.&#x27;);
	}

	/**
	 * This method processes the request on the GET account with id endpoint from the account controller.
	 *
	 * @param currentUser the request user
	 * @param params the request parameters
	 * @throws {ForbiddenOperationError}
	 * @throws {EntityNotFoundError}
	 */
	async findAccountById(currentUser: ICurrentUser, params: AccountByIdParams): Promise&lt;AccountResponse&gt; {
		if (!(await this.isSuperhero(currentUser))) {
			throw new ForbiddenOperationError(&#x27;Current user is not authorized to search for accounts.&#x27;);
		}
		const account &#x3D; await this.accountService.findById(params.id);
		return AccountResponseMapper.mapToResponse(account);
	}

	async saveAccount(dto: AccountSaveDto): Promise&lt;void&gt; {
		await validateOrReject(dto);
		// sanatizeUsername 
		if (!dto.systemId) {
			dto.username &#x3D; dto.username.trim().toLowerCase();
		}
		if (!dto.systemId &amp;&amp; !dto.password) {
			throw new ValidationError(&#x27;No password provided&#x27;);
		}
		// validateUserName 
		// usernames must be an email address, if they are not from an external system
		if (!dto.systemId &amp;&amp; !isEmail(dto.username)) {
			throw new ValidationError(&#x27;Username is not an email&#x27;);
		}
		// checkExistence 
		if (dto.userId &amp;&amp; (await this.accountService.findByUserId(dto.userId))) {
			throw new ValidationError(&#x27;Account already exists&#x27;);
		}
		// validateCredentials hook will not be ported 
		// trimPassword hook will be done by class-validator 
		// local.hooks.hashPassword(&#x27;password&#x27;), will be done by account service 
		// checkUnique 
		if (!(await this.accountValidationService.isUniqueEmail(dto.username, dto.userId, dto.id, dto.systemId))) {
			throw new ValidationError(&#x27;Username already exists&#x27;);
		}
		// removePassword hook is not implemented
		// const noPasswordStrategies &#x3D; [&#x27;ldap&#x27;, &#x27;moodle&#x27;, &#x27;iserv&#x27;];
		// if (dto.passwordStrategy &amp;&amp; noPasswordStrategies.includes(dto.passwordStrategy)) {
		// 	dto.password &#x3D; undefined;
		// }

		await this.accountService.save(dto);
	}

	/**
	 * This method processes the request on the PATCH account with id endpoint from the account controller.
	 *
	 * @param currentUser the request user
	 * @param params the request parameters
	 * @param body the request body
	 * @throws {ForbiddenOperationError}
	 * @throws {EntityNotFoundError}
	 */
	async updateAccountById(
		currentUser: ICurrentUser,
		params: AccountByIdParams,
		body: AccountByIdBodyParams
	): Promise&lt;AccountResponse&gt; {
		const executingUser &#x3D; await this.userRepo.findById(currentUser.userId, true);
		const targetAccount &#x3D; await this.accountService.findById(params.id);

		if (!targetAccount.userId) {
			throw new EntityNotFoundError(User.name);
		}

		const targetUser &#x3D; await this.userRepo.findById(targetAccount.userId, true);

		let updateUser &#x3D; false;
		let updateAccount &#x3D; false;

		if (!this.hasPermissionsToAccessAccount(executingUser, targetUser, &#x27;UPDATE&#x27;)) {
			throw new ForbiddenOperationError(&#x27;Current user is not authorized to update target account.&#x27;);
		}
		if (body.password !&#x3D;&#x3D; undefined) {
			targetAccount.password &#x3D; body.password;
			targetUser.forcePasswordChange &#x3D; true;
			updateUser &#x3D; true;
			updateAccount &#x3D; true;
		}
		if (body.username !&#x3D;&#x3D; undefined) {
			const newMail &#x3D; body.username.toLowerCase();
			await this.checkUniqueEmail(targetAccount, targetUser, newMail);
			targetUser.email &#x3D; newMail;
			targetAccount.username &#x3D; newMail;
			updateUser &#x3D; true;
			updateAccount &#x3D; true;
		}
		if (body.activated !&#x3D;&#x3D; undefined) {
			targetAccount.activated &#x3D; body.activated;
			updateAccount &#x3D; true;
		}

		if (updateUser) {
			try {
				await this.userRepo.save(targetUser);
			} catch (err) {
				throw new EntityNotFoundError(User.name);
			}
		}
		if (updateAccount) {
			try {
				await this.accountService.save(targetAccount);
			} catch (err) {
				throw new EntityNotFoundError(Account.name);
			}
		}
		return AccountResponseMapper.mapToResponse(targetAccount);
	}

	/**
	 * This method processes the request on the DELETE account with id endpoint from the account controller.
	 *
	 * @param currentUser the request user
	 * @param params the request parameters
	 * @throws {ForbiddenOperationError}
	 * @throws {EntityNotFoundError}
	 */
	async deleteAccountById(currentUser: ICurrentUser, params: AccountByIdParams): Promise&lt;AccountResponse&gt; {
		if (!(await this.isSuperhero(currentUser))) {
			throw new ForbiddenOperationError(&#x27;Current user is not authorized to delete an account.&#x27;);
		}
		const account: AccountDto &#x3D; await this.accountService.findById(params.id);
		await this.accountService.delete(account.id);
		return AccountResponseMapper.mapToResponse(account);
	}

	/**
	 * This method allows to update my (currentUser) account details.
	 *
	 * @param currentUserId the current user
	 * @param params account details
	 */
	async updateMyAccount(currentUserId: EntityId, params: PatchMyAccountParams) {
		const user &#x3D; await this.userRepo.findById(currentUserId, true);
		const account: AccountDto &#x3D; await this.accountService.findByUserIdOrFail(currentUserId);

		if (account.systemId) {
			throw new ForbiddenOperationError(&#x27;External account details can not be changed.&#x27;);
		}

		if (!params.passwordOld || !account.password || !(await this.checkPassword(params.passwordOld, account.password))) {
			throw new AuthorizationError(&#x27;Dein Passwort ist nicht korrekt!&#x27;);
		}

		let updateUser &#x3D; false;
		let updateAccount &#x3D; false;
		if (params.passwordNew) {
			account.password &#x3D; params.passwordNew;
			updateAccount &#x3D; true;
		} else {
			account.password &#x3D; undefined;
		}

		if (params.email &amp;&amp; user.email !&#x3D;&#x3D; params.email) {
			const newMail &#x3D; params.email.toLowerCase();
			await this.checkUniqueEmail(account, user, newMail);
			user.email &#x3D; newMail;
			account.username &#x3D; newMail;
			updateUser &#x3D; true;
			updateAccount &#x3D; true;
		}

		if (params.firstName &amp;&amp; user.firstName !&#x3D;&#x3D; params.firstName) {
			if (!this.hasPermissionsToChangeOwnName(user)) {
				throw new ForbiddenOperationError(&#x27;No permission to change first name&#x27;);
			}
			user.firstName &#x3D; params.firstName;
			updateUser &#x3D; true;
		}
		if (params.lastName &amp;&amp; user.lastName !&#x3D;&#x3D; params.lastName) {
			if (!this.hasPermissionsToChangeOwnName(user)) {
				throw new ForbiddenOperationError(&#x27;No permission to change last name&#x27;);
			}
			user.lastName &#x3D; params.lastName;
			updateUser &#x3D; true;
		}

		if (updateUser) {
			try {
				await this.userRepo.save(user);
			} catch (err) {
				throw new EntityNotFoundError(User.name);
			}
		}
		if (updateAccount) {
			try {
				await this.accountService.save(account);
			} catch (err) {
				throw new EntityNotFoundError(Account.name);
			}
		}
	}

	/**
	 * This method is used to replace my (currentUser) temporary password.
	 * Callable when the current user&#x27;s password was force set or this is the first login.
	 *
	 * @param userId the current user
	 * @param password the new password
	 * @param confirmPassword the new password (has to match password)
	 */
	async replaceMyTemporaryPassword(userId: EntityId, password: string, confirmPassword: string): Promise&lt;void&gt; {
		if (password !&#x3D;&#x3D; confirmPassword) {
			throw new ForbiddenOperationError(&#x27;Password and confirm password do not match.&#x27;);
		}

		let user: User;
		try {
			user &#x3D; await this.userRepo.findById(userId);
		} catch (err) {
			throw new EntityNotFoundError(User.name);
		}

		const userPreferences &#x3D; &lt;UserPreferences&gt;user.preferences;
		const firstLoginPassed &#x3D; userPreferences ? userPreferences.firstLogin : false;

		if (!user.forcePasswordChange &amp;&amp; firstLoginPassed) {
			throw new ForbiddenOperationError(&#x27;The password is not temporary, hence can not be changed.&#x27;);
		} // Password change was forces or this is a first logon for the user

		const account: AccountDto &#x3D; await this.accountService.findByUserIdOrFail(userId);

		if (account.systemId) {
			throw new ForbiddenOperationError(&#x27;External account details can not be changed.&#x27;);
		}

		if (!account.password) {
			throw new Error(&#x27;The account does not have a password to compare against.&#x27;);
		} else if (await this.checkPassword(password, account.password)) {
			throw new ForbiddenOperationError(&#x27;New password can not be same as old password.&#x27;);
		}

		try {
			account.password &#x3D; password;
			await this.accountService.save(account);
		} catch (err) {
			throw new EntityNotFoundError(Account.name);
		}
		try {
			user.forcePasswordChange &#x3D; false;
			await this.userRepo.save(user);
		} catch (err) {
			throw new EntityNotFoundError(User.name);
		}
	}

	async checkBrutForce(username: string, systemId: EntityId | ObjectId): Promise&lt;void&gt; {
		const account &#x3D; await this.accountService.findByUsernameAndSystemId(username, systemId);
		//  missing Account is ignored as in legacy feathers Impl.
		if (account) {
			if (account.lasttriedFailedLogin) {
				const timeDifference &#x3D; (new Date().getTime() - account.lasttriedFailedLogin.getTime()) / 1000;
				if (timeDifference &lt; this.configService.get&lt;number&gt;(&#x27;LOGIN_BLOCK_TIME&#x27;)) {
					throw new BruteForcePrevention(&#x27;Brute Force Prevention!&#x27;, {
						timeToWait: this.configService.get&lt;number&gt;(&#x27;LOGIN_BLOCK_TIME&#x27;) - Math.ceil(timeDifference),
					});
				}
			}
			await this.accountService.updateLastTriedFailedLogin(account.id, new Date());
		}
	}

	private async checkUniqueEmail(account: AccountDto, user: User, email: string): Promise&lt;void&gt; {
		if (!(await this.accountValidationService.isUniqueEmail(email, user.id, account.id, account.systemId))) {
			throw new ValidationError(&#x60;The email address is already in use!&#x60;);
		}
	}

	private hasRole(user: User, roleName: string) {
		return user.roles.getItems().some((role) &#x3D;&gt; role.name &#x3D;&#x3D;&#x3D; roleName);
	}

	private async isSuperhero(currentUser: ICurrentUser): Promise&lt;boolean&gt; {
		const user &#x3D; await this.userRepo.findById(currentUser.userId, true);
		return user.roles.getItems().some((role) &#x3D;&gt; role.name &#x3D;&#x3D;&#x3D; RoleName.SUPERHERO);
	}

	private hasPermissionsToChangeOwnName(currentUser: User) {
		return (
			this.hasRole(currentUser, RoleName.SUPERHERO) ||
			this.hasRole(currentUser, RoleName.TEACHER) ||
			this.hasRole(currentUser, RoleName.ADMINISTRATOR)
		);
	}

	private hasPermissionsToAccessAccount(
		currentUser: User,
		targetUser: User,
		action: &#x27;READ&#x27; | &#x27;UPDATE&#x27; | &#x27;DELETE&#x27; | &#x27;CREATE&#x27;
	) {
		if (this.hasRole(currentUser, RoleName.SUPERHERO)) {
			return true;
		}
		if (!(currentUser.school.id &#x3D;&#x3D;&#x3D; targetUser.school.id)) {
			return false;
		}

		const permissionsToCheck: string[] &#x3D; [];
		if (this.hasRole(targetUser, RoleName.STUDENT)) {
			// eslint-disable-next-line default-case
			switch (action) {
				case &#x27;READ&#x27;:
					permissionsToCheck.push(Permission.STUDENT_LIST);
					break;
				case &#x27;UPDATE&#x27;:
					permissionsToCheck.push(Permission.STUDENT_EDIT);
					break;
				// for future endpoints
				/* case &#x27;CREATE&#x27;:
					permissionsToCheck.push(&#x27;STUDENT_CREATE&#x27;);
					break;
				case &#x27;DELETE&#x27;:
					permissionsToCheck.push(&#x27;STUDENT_DELETE&#x27;);
					break;
				*/
			}
		}
		if (this.hasRole(targetUser, RoleName.TEACHER)) {
			// eslint-disable-next-line default-case
			switch (action) {
				case &#x27;READ&#x27;:
					permissionsToCheck.push(Permission.TEACHER_LIST);
					break;
				case &#x27;UPDATE&#x27;:
					permissionsToCheck.push(Permission.TEACHER_EDIT);
					break;
				// for future endpoints
				/* case &#x27;CREATE&#x27;:
					permissionsToCheck.push(&#x27;TEACHER_CREATE&#x27;);
					break;
				case &#x27;DELETE&#x27;:
					permissionsToCheck.push(&#x27;TEACHER_DELETE&#x27;);
					break; 
 				*/
			}
		}
		if (permissionsToCheck.length &#x3D;&#x3D;&#x3D; 0) {
			// target user is neither student nor teacher. Undefined what to do
			return false;
		}

		return (
			this.permissionService.hasUserAllSchoolPermissions(currentUser, permissionsToCheck) ||
			this.schoolPermissionExists(
				this.extractRoles(currentUser.roles.getItems()),
				currentUser.school,
				permissionsToCheck
			)
		);
	}

	private schoolPermissionExists(roles: string[], school: School, permissions: string[]): boolean {
		if (this.configService.get&lt;boolean&gt;(&#x27;TEACHER_STUDENT_VISIBILITY__IS_CONFIGURABLE&#x27;)) {
			if (
				roles.find((role) &#x3D;&gt; role &#x3D;&#x3D;&#x3D; RoleName.TEACHER) &amp;&amp;
				permissions.find((permission) &#x3D;&gt; permission &#x3D;&#x3D;&#x3D; Permission.STUDENT_LIST)
			) {
				return school.permissions?.teacher?.STUDENT_LIST ?? false;
			}
		}
		return false;
	}

	private extractRoles(inputRoles: Role[]): string[] {
		const roles: string[] &#x3D; [];

		for (let i &#x3D; 0; i &lt; inputRoles.length; i +&#x3D; 1) {
			const role &#x3D; inputRoles[i];
			roles.push(role.name);
			const innerRoles &#x3D; role.roles.getItems().map((x) &#x3D;&gt; x.name);
			roles.push(...innerRoles);
		}

		return roles;
	}

	private async checkPassword(enteredPassword: string, hashedAccountPassword: string) {
		return bcrypt.compare(enteredPassword, hashedAccountPassword);
	}
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'AccountUc.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
