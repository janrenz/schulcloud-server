<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>schulcloud-server documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">schulcloud-server documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li>Injectables</li>
  <li >VideoConferenceUc</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>apps/server/src/modules/video-conference/uc/video-conference.uc.ts</code>
        </p>





            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#hostURL" >hostURL</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Protected</span>
                                    <span class="modifier">Async</span>
                                <a href="#checkPermission" >checkPermission</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#create" >create</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#end" >end</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getMeetingInfo" >getMeetingInfo</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                    <span class="modifier">Async</span>
                                <a href="#getScopeInfo" >getScopeInfo</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#join" >join</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Static</span>
                                <a href="#sanitizeString" >sanitizeString</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                    <span class="modifier">Async</span>
                                <a href="#throwOnFeaturesDisabled" >throwOnFeaturesDisabled</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(bbbService: <a href="../injectables/BBBService.html" target="_self">BBBService</a>, authorizationService: <a href="../injectables/AuthorizationService.html" target="_self">AuthorizationService</a>, videoConferenceRepo: <a href="../injectables/VideoConferenceRepo.html" target="_self">VideoConferenceRepo</a>, teamsRepo: <a href="../injectables/TeamsRepo.html" target="_self">TeamsRepo</a>, courseRepo: <a href="../injectables/CourseRepo.html" target="_self">CourseRepo</a>, userRepo: <a href="../injectables/UserRepo.html" target="_self">UserRepo</a>, calendarService: <a href="../injectables/CalendarService.html" target="_self">CalendarService</a>, schoolUc: <a href="../injectables/SchoolUc.html" target="_self">SchoolUc</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="67" class="link-to-prism">apps/server/src/modules/video-conference/uc/video-conference.uc.ts:67</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>bbbService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/BBBService.html" target="_self" >BBBService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>authorizationService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/AuthorizationService.html" target="_self" >AuthorizationService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>videoConferenceRepo</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/VideoConferenceRepo.html" target="_self" >VideoConferenceRepo</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>teamsRepo</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/TeamsRepo.html" target="_self" >TeamsRepo</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>courseRepo</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/CourseRepo.html" target="_self" >CourseRepo</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userRepo</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/UserRepo.html" target="_self" >UserRepo</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>calendarService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/CalendarService.html" target="_self" >CalendarService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>schoolUc</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/SchoolUc.html" target="_self" >SchoolUc</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkPermission"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span class="modifier">Async</span>
                        <span ><b>checkPermission</b></span>
                        <a href="#checkPermission"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>checkPermission(userId: <a href="../undefineds/EntityId.html" target="_self">EntityId</a>, conferenceScope: <a href="../entitys/VideoConference.html" target="_self">VideoConferenceScope</a>, entityId: <a href="../undefineds/EntityId.html" target="_self">EntityId</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="348"
                            class="link-to-prism">apps/server/src/modules/video-conference/uc/video-conference.uc.ts:348</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Checks if the user has the required permissions and returns their associated role in BBB.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="../miscellaneous/typealiases.html#EntityId" target="_self" >EntityId</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>conferenceScope</td>
                                    <td>
                                                <code><a href="../entitys/VideoConference.html" target="_self" >VideoConferenceScope</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>entityId</td>
                                    <td>
                                                <code><a href="../miscellaneous/typealiases.html#EntityId" target="_self" >EntityId</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../entitys/Role.html" target="_self" >Promise&lt;BBBRole&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="create"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>create</b></span>
                        <a href="#create"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>create(currentUser: <a href="../interfaces/ICurrentUser.html" target="_self">ICurrentUser</a>, conferenceScope: <a href="../entitys/VideoConference.html" target="_self">VideoConferenceScope</a>, refId: <a href="../undefineds/EntityId.html" target="_self">EntityId</a>, options: <a href="../interfaces/VideoConferenceOptions.html" target="_self">VideoConferenceOptions</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="90"
                            class="link-to-prism">apps/server/src/modules/video-conference/uc/video-conference.uc.ts:90</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Creates a new video conference.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>currentUser</td>
                                    <td>
                                                <code><a href="../interfaces/ICurrentUser.html" target="_self" >ICurrentUser</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                    </td>
                                </tr>
                                <tr>
                                    <td>conferenceScope</td>
                                    <td>
                                                <code><a href="../entitys/VideoConference.html" target="_self" >VideoConferenceScope</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                    </td>
                                </tr>
                                <tr>
                                    <td>refId</td>
                                    <td>
                                                <code><a href="../miscellaneous/typealiases.html#EntityId" target="_self" >EntityId</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>eventId or courseId, depending on scope.</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>options</td>
                                    <td>
                                                <code><a href="../interfaces/VideoConferenceOptions.html" target="_self" >VideoConferenceOptions</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../classes/VideoConference.html" target="_self" >Promise&lt;VideoConferenceDTO&lt;BBBCreateResponse&gt;&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="end"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>end</b></span>
                        <a href="#end"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>end(currentUser: <a href="../interfaces/ICurrentUser.html" target="_self">ICurrentUser</a>, conferenceScope: <a href="../entitys/VideoConference.html" target="_self">VideoConferenceScope</a>, refId: <a href="../undefineds/EntityId.html" target="_self">EntityId</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="274"
                            class="link-to-prism">apps/server/src/modules/video-conference/uc/video-conference.uc.ts:274</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Ends a video conference.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>currentUser</td>
                                    <td>
                                                <code><a href="../interfaces/ICurrentUser.html" target="_self" >ICurrentUser</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                    </td>
                                </tr>
                                <tr>
                                    <td>conferenceScope</td>
                                    <td>
                                                <code><a href="../entitys/VideoConference.html" target="_self" >VideoConferenceScope</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                    </td>
                                </tr>
                                <tr>
                                    <td>refId</td>
                                    <td>
                                                <code><a href="../miscellaneous/typealiases.html#EntityId" target="_self" >EntityId</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>eventId or courseId, depending on scope.</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../classes/VideoConference.html" target="_self" >Promise&lt;VideoConferenceDTO&lt;BBBBaseResponse&gt;&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getMeetingInfo"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>getMeetingInfo</b></span>
                        <a href="#getMeetingInfo"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getMeetingInfo(currentUser: <a href="../interfaces/ICurrentUser.html" target="_self">ICurrentUser</a>, conferenceScope: <a href="../entitys/VideoConference.html" target="_self">VideoConferenceScope</a>, refId: <a href="../undefineds/EntityId.html" target="_self">EntityId</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="225"
                            class="link-to-prism">apps/server/src/modules/video-conference/uc/video-conference.uc.ts:225</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Retrieves information about a video conference.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>currentUser</td>
                                    <td>
                                                <code><a href="../interfaces/ICurrentUser.html" target="_self" >ICurrentUser</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                    </td>
                                </tr>
                                <tr>
                                    <td>conferenceScope</td>
                                    <td>
                                                <code><a href="../entitys/VideoConference.html" target="_self" >VideoConferenceScope</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                    </td>
                                </tr>
                                <tr>
                                    <td>refId</td>
                                    <td>
                                                <code><a href="../miscellaneous/typealiases.html#EntityId" target="_self" >EntityId</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>eventId or courseId, depending on scope.</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/VideoConferenceInfoDTO.html" target="_self" >Promise&lt;VideoConferenceInfoDTO&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getScopeInfo"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span class="modifier">Async</span>
                        <span ><b>getScopeInfo</b></span>
                        <a href="#getScopeInfo"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getScopeInfo(userId: <a href="../undefineds/EntityId.html" target="_self">EntityId</a>, conferenceScope: <a href="../entitys/VideoConference.html" target="_self">VideoConferenceScope</a>, refId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="311"
                            class="link-to-prism">apps/server/src/modules/video-conference/uc/video-conference.uc.ts:311</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Retrieves information about the permission scope based on the scope of the video conference.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="../miscellaneous/typealiases.html#EntityId" target="_self" >EntityId</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                    </td>
                                </tr>
                                <tr>
                                    <td>conferenceScope</td>
                                    <td>
                                                <code><a href="../entitys/VideoConference.html" target="_self" >VideoConferenceScope</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                    </td>
                                </tr>
                                <tr>
                                    <td>refId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>eventId or courseId, depending on scope.</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/IScopeInfo.html" target="_self" >Promise&lt;IScopeInfo&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="join"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>join</b></span>
                        <a href="#join"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>join(currentUser: <a href="../interfaces/ICurrentUser.html" target="_self">ICurrentUser</a>, conferenceScope: <a href="../entitys/VideoConference.html" target="_self">VideoConferenceScope</a>, refId: <a href="../undefineds/EntityId.html" target="_self">EntityId</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="151"
                            class="link-to-prism">apps/server/src/modules/video-conference/uc/video-conference.uc.ts:151</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Generates a join link for a video conference.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>currentUser</td>
                                    <td>
                                                <code><a href="../interfaces/ICurrentUser.html" target="_self" >ICurrentUser</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                    </td>
                                </tr>
                                <tr>
                                    <td>conferenceScope</td>
                                    <td>
                                                <code><a href="../entitys/VideoConference.html" target="_self" >VideoConferenceScope</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                    </td>
                                </tr>
                                <tr>
                                    <td>refId</td>
                                    <td>
                                                <code><a href="../miscellaneous/typealiases.html#EntityId" target="_self" >EntityId</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>eventId or courseId, depending on scope.</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/VideoConferenceJoinDTO.html" target="_self" >Promise&lt;VideoConferenceJoinDTO&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="sanitizeString"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span class="modifier">Static</span>
                        <span ><b>sanitizeString</b></span>
                        <a href="#sanitizeString"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>sanitizeString(text: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="387"
                            class="link-to-prism">apps/server/src/modules/video-conference/uc/video-conference.uc.ts:387</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>text</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="throwOnFeaturesDisabled"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span class="modifier">Async</span>
                        <span ><b>throwOnFeaturesDisabled</b></span>
                        <a href="#throwOnFeaturesDisabled"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>throwOnFeaturesDisabled(schoolId: <a href="../undefineds/EntityId.html" target="_self">EntityId</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="375"
                            class="link-to-prism">apps/server/src/modules/video-conference/uc/video-conference.uc.ts:375</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Throws an error if the feature is disabled for the school or for the entire instance.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>schoolId</td>
                                    <td>
                                                <code><a href="../miscellaneous/typealiases.html#EntityId" target="_self" >EntityId</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section>
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hostURL"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>hostURL</b></span>
                        <a href="#hostURL"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="67" class="link-to-prism">apps/server/src/modules/video-conference/uc/video-conference.uc.ts:67</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { BadRequestException, ForbiddenException, Injectable } from &#x27;@nestjs/common&#x27;;
import { BBBRole } from &#x27;@src/modules/video-conference/config/bbb-join.config&#x27;;
import { BBBBaseMeetingConfig } from &#x27;@src/modules/video-conference/config/bbb-base-meeting.config&#x27;;
import {
	Actions,
	Course,
	EntityId,
	ICurrentUser,
	Permission,
	RoleName,
	SchoolFeatures,
	Team,
	TeamUser,
	User,
	VideoConferenceDO,
	VideoConferenceOptionsDO,
} from &#x27;@shared/domain&#x27;;
import { AllowedAuthorizationEntityType } from &#x27;@src/modules/authorization/interfaces&#x27;;
import { Configuration } from &#x27;@hpi-schul-cloud/commons/lib&#x27;;
import { SchoolUc } from &#x27;@src/modules/school/uc/school.uc&#x27;;
import { BBBJoinConfigBuilder } from &#x27;@src/modules/video-conference/builder/bbb-join-config.builder&#x27;;
import { BBBCreateConfigBuilder } from &#x27;@src/modules/video-conference/builder/bbb-create-config.builder&#x27;;
import { CourseRepo, TeamsRepo, UserRepo } from &#x27;@shared/repo&#x27;;
import { CalendarService } from &#x27;@shared/infra/calendar&#x27;;
import {
	BBBBaseResponse,
	BBBCreateResponse,
	BBBMeetingInfoResponse,
	BBBResponse,
} from &#x27;@src/modules/video-conference/interface/bbb-response.interface&#x27;;
import { VideoConferenceScope } from &#x27;@shared/domain/interface/vc-scope.enum&#x27;;
import { BBBService } from &#x27;@src/modules/video-conference/service/bbb.service&#x27;;
import { VideoConferenceRepo } from &#x27;@shared/repo/videoconference/video-conference.repo&#x27;;
import { GuestPolicy } from &#x27;@src/modules/video-conference/config/bbb-create.config&#x27;;
import {
	defaultVideoConferenceOptions,
	VideoConferenceOptions,
} from &#x27;@src/modules/video-conference/interface/vc-options.interface&#x27;;
import { AuthorizationService } from &#x27;@src/modules/authorization&#x27;;
import { VideoConferenceState } from &#x27;@src/modules/video-conference/controller/dto/vc-state.enum&#x27;;
import {
	VideoConferenceDTO,
	VideoConferenceInfoDTO,
	VideoConferenceJoinDTO,
} from &#x27;@src/modules/video-conference/dto/video-conference.dto&#x27;;
import { CalendarEventDto } from &#x27;@shared/infra/calendar/dto/calendar-event.dto&#x27;;

export interface IScopeInfo {
	scopeId: EntityId;
	scopeName: string;
	logoutUrl: string;
	title: string;
}

const PermissionMapping &#x3D; {
	[BBBRole.MODERATOR]: Permission.START_MEETING,
	[BBBRole.VIEWER]: Permission.JOIN_MEETING,
};

const PermissionScopeMapping &#x3D; {
	[VideoConferenceScope.COURSE]: AllowedAuthorizationEntityType.Course,
	[VideoConferenceScope.EVENT]: AllowedAuthorizationEntityType.Team,
};

@Injectable()
export class VideoConferenceUc {
	private readonly hostURL: string;

	constructor(
		private readonly bbbService: BBBService,
		private readonly authorizationService: AuthorizationService,
		private readonly videoConferenceRepo: VideoConferenceRepo,
		private readonly teamsRepo: TeamsRepo,
		private readonly courseRepo: CourseRepo,
		private readonly userRepo: UserRepo,
		private readonly calendarService: CalendarService,
		private readonly schoolUc: SchoolUc
	) {
		this.hostURL &#x3D; Configuration.get(&#x27;HOST&#x27;) as string;
	}

	/**
	 * Creates a new video conference.
	 * @param {ICurrentUser} currentUser
	 * @param {VideoConferenceScope} conferenceScope
	 * @param {EntityId} refId eventId or courseId, depending on scope.
	 * @param {VideoConferenceOptions} options
	 * @returns {Promise&lt;VideoConferenceDTO&lt;BBBCreateResponse&gt;&gt;}
	 */
	async create(
		currentUser: ICurrentUser,
		conferenceScope: VideoConferenceScope,
		refId: EntityId,
		options: VideoConferenceOptions
	): Promise&lt;VideoConferenceDTO&lt;BBBCreateResponse&gt;&gt; {
		const { userId, schoolId } &#x3D; currentUser;

		await this.throwOnFeaturesDisabled(schoolId);
		const scopeInfo: IScopeInfo &#x3D; await this.getScopeInfo(userId, conferenceScope, refId);

		const bbbRole: BBBRole &#x3D; await this.checkPermission(userId, conferenceScope, scopeInfo.scopeId);

		if (bbbRole !&#x3D;&#x3D; BBBRole.MODERATOR) {
			throw new ForbiddenException(&#x27;you are not allowed to start the videoconference. ask a moderator.&#x27;);
		}

		const configBuilder: BBBCreateConfigBuilder &#x3D; new BBBCreateConfigBuilder({
			name: VideoConferenceUc.sanitizeString(scopeInfo.title),
			meetingID: refId,
		}).withLogoutUrl(scopeInfo.logoutUrl);

		if (options.moderatorMustApproveJoinRequests) {
			configBuilder.withGuestPolicy(GuestPolicy.ASK_MODERATOR);
		}

		if (options.everyAttendeeJoinsMuted) {
			configBuilder.withMuteOnStart(true);
		}

		let vcDo: VideoConferenceDO;
		try {
			// Patch options, if preset exists
			vcDo &#x3D; await this.videoConferenceRepo.findByScopeId(refId, conferenceScope);
			vcDo.options &#x3D; options;
		} catch (error) {
			// Create new preset
			vcDo &#x3D; new VideoConferenceDO({
				target: refId,
				targetModel: conferenceScope,
				options,
			});
		}
		await this.videoConferenceRepo.save(vcDo);

		const bbbResponse: BBBResponse&lt;BBBCreateResponse&gt; &#x3D; await this.bbbService.create(configBuilder.build());

		return {
			state: VideoConferenceState.NOT_STARTED,
			permission: PermissionMapping[bbbRole],
			bbbResponse,
		};
	}

	/**
	 * Generates a join link for a video conference.
	 * @param {ICurrentUser} currentUser
	 * @param {VideoConferenceScope} conferenceScope
	 * @param {EntityId} refId eventId or courseId, depending on scope.
	 * @returns {Promise&lt;VideoConferenceJoinDTO&gt;}
	 */
	async join(
		currentUser: ICurrentUser,
		conferenceScope: VideoConferenceScope,
		refId: EntityId
	): Promise&lt;VideoConferenceJoinDTO&gt; {
		const { userId, schoolId } &#x3D; currentUser;

		await this.throwOnFeaturesDisabled(schoolId);

		const scopeInfo: IScopeInfo &#x3D; await this.getScopeInfo(userId, conferenceScope, refId);

		const bbbRole: BBBRole &#x3D; await this.checkPermission(userId, conferenceScope, scopeInfo.scopeId);

		const resolvedUser: User &#x3D; await this.userRepo.findById(userId);
		const configBuilder: BBBJoinConfigBuilder &#x3D; new BBBJoinConfigBuilder({
			fullName: VideoConferenceUc.sanitizeString(&#x60;${resolvedUser.firstName} ${resolvedUser.lastName}&#x60;),
			meetingID: refId,
			role: bbbRole,
		});

		// Let experts join as guests
		switch (conferenceScope) {
			case VideoConferenceScope.COURSE: {
				const roles: RoleName[] &#x3D; currentUser.roles.map((role) &#x3D;&gt; role as RoleName);

				if (roles.includes(RoleName.EXPERT)) {
					configBuilder.asGuest(true);
				}
				break;
			}
			case VideoConferenceScope.EVENT: {
				const team: Team &#x3D; await this.teamsRepo.findById(scopeInfo.scopeId);
				const teamUser: TeamUser | undefined &#x3D; team.userIds.find(
					(userInTeam) &#x3D;&gt; userInTeam.userId.id &#x3D;&#x3D;&#x3D; currentUser.userId
				);

				if (teamUser &#x3D;&#x3D;&#x3D; undefined) {
					throw new ForbiddenException(&#x27;cannot find user in team&#x27;);
				}

				if (teamUser.role.name &#x3D;&#x3D;&#x3D; RoleName.TEAMEXPERT) {
					configBuilder.asGuest(true);
				}
				break;
			}
			/* istanbul ignore next */
			default:
				throw new BadRequestException(&#x27;Unknown scope name&#x27;);
		}

		configBuilder.withUserId(currentUser.userId);

		const vcDO: VideoConferenceDO &#x3D; await this.videoConferenceRepo.findByScopeId(refId, conferenceScope);

		if (vcDO.options.everybodyJoinsAsModerator) {
			configBuilder.withRole(BBBRole.MODERATOR);
		}

		const url: string &#x3D; await this.bbbService.join(configBuilder.build());

		return {
			state: VideoConferenceState.RUNNING,
			permission: PermissionMapping[bbbRole],
			url,
		};
	}

	/**
	 * Retrieves information about a video conference.
	 * @param {ICurrentUser} currentUser
	 * @param {VideoConferenceScope} conferenceScope
	 * @param {EntityId} refId eventId or courseId, depending on scope.
	 * @returns {BBBResponse&lt;BBBBaseMeetingConfig&gt;}
	 */
	async getMeetingInfo(
		currentUser: ICurrentUser,
		conferenceScope: VideoConferenceScope,
		refId: EntityId
	): Promise&lt;VideoConferenceInfoDTO&gt; {
		const { userId, schoolId } &#x3D; currentUser;

		await this.throwOnFeaturesDisabled(schoolId);

		const scopeInfo: IScopeInfo &#x3D; await this.getScopeInfo(userId, conferenceScope, refId);

		const bbbRole: BBBRole &#x3D; await this.checkPermission(userId, conferenceScope, scopeInfo.scopeId);

		const config: BBBBaseMeetingConfig &#x3D; new BBBBaseMeetingConfig({
			meetingID: refId,
		});

		let bbbResponse: BBBResponse&lt;BBBMeetingInfoResponse&gt;;

		const options: VideoConferenceOptionsDO &#x3D; await this.videoConferenceRepo
			.findByScopeId(refId, conferenceScope)
			.then((vcDO: VideoConferenceDO) &#x3D;&gt; vcDO.options)
			.catch(() &#x3D;&gt; defaultVideoConferenceOptions);

		try {
			bbbResponse &#x3D; await this.bbbService.getMeetingInfo(config);
		} catch (error) {
			return {
				state: VideoConferenceState.NOT_STARTED,
				permission: PermissionMapping[bbbRole],
				options: bbbRole &#x3D;&#x3D;&#x3D; BBBRole.MODERATOR ? options : ({} as VideoConferenceOptions),
			};
		}

		return {
			state: VideoConferenceState.RUNNING,
			permission: PermissionMapping[bbbRole],
			bbbResponse,
			options: bbbRole &#x3D;&#x3D;&#x3D; BBBRole.MODERATOR ? options : ({} as VideoConferenceOptions),
		};
	}

	/**
	 * Ends a video conference.
	 * @param {ICurrentUser} currentUser
	 * @param {VideoConferenceScope} conferenceScope
	 * @param {EntityId} refId eventId or courseId, depending on scope.
	 * @returns {Promise&lt;VideoConferenceDTO&lt;BBBBaseResponse&gt;&gt;}
	 */
	async end(
		currentUser: ICurrentUser,
		conferenceScope: VideoConferenceScope,
		refId: EntityId
	): Promise&lt;VideoConferenceDTO&lt;BBBBaseResponse&gt;&gt; {
		const { userId, schoolId } &#x3D; currentUser;

		await this.throwOnFeaturesDisabled(schoolId);

		const { scopeId } &#x3D; await this.getScopeInfo(userId, conferenceScope, refId);

		const bbbRole: BBBRole &#x3D; await this.checkPermission(userId, conferenceScope, scopeId);

		if (bbbRole !&#x3D;&#x3D; BBBRole.MODERATOR) {
			throw new ForbiddenException();
		}

		const config: BBBBaseMeetingConfig &#x3D; new BBBBaseMeetingConfig({
			meetingID: refId,
		});

		const bbbResponse: BBBResponse&lt;BBBBaseResponse&gt; &#x3D; await this.bbbService.end(config);

		return {
			state: VideoConferenceState.FINISHED,
			permission: PermissionMapping[bbbRole],
			bbbResponse,
		};
	}

	/**
	 * Retrieves information about the permission scope based on the scope of the video conference.
	 * @param {EntityId} userId
	 * @param {VideoConferenceScope} conferenceScope
	 * @param {EntityId} refId eventId or courseId, depending on scope.
	 * @returns {Promise&lt;IScopeInfo&gt;}
	 */
	protected async getScopeInfo(
		userId: EntityId,
		conferenceScope: VideoConferenceScope,
		refId: string
	): Promise&lt;IScopeInfo&gt; {
		switch (conferenceScope) {
			case VideoConferenceScope.COURSE: {
				const course: Course &#x3D; await this.courseRepo.findById(refId);
				return {
					scopeId: refId,
					scopeName: &#x27;courses&#x27;,
					logoutUrl: &#x60;${this.hostURL}/courses/${refId}?activeTab&#x3D;tools&#x60;,
					title: course.name,
				};
			}
			case VideoConferenceScope.EVENT: {
				const event: CalendarEventDto &#x3D; await this.calendarService.findEvent(userId, refId);
				return {
					scopeId: event.teamId,
					scopeName: &#x27;teams&#x27;,
					logoutUrl: &#x60;${this.hostURL}/teams/${event.teamId}?activeTab&#x3D;events&#x60;,
					title: event.title,
				};
			}
			default:
				throw new BadRequestException(&#x27;Unknown scope name&#x27;);
		}
	}

	/**
	 * Checks if the user has the required permissions and returns their associated role in BBB.
	 * @param {EntityId} userId
	 * @param {VideoConferenceScope} conferenceScope
	 * @param {EntityId} entityId
	 * @throws {ForbiddenException}
	 * @returns {Promise&lt;BBBRole&gt;}
	 */
	protected async checkPermission(
		userId: EntityId,
		conferenceScope: VideoConferenceScope,
		entityId: EntityId
	): Promise&lt;BBBRole&gt; {
		const permissionMap: Map&lt;Permission, Promise&lt;boolean&gt;&gt; &#x3D; this.authorizationService.hasPermissionsByReferences(
			userId,
			PermissionScopeMapping[conferenceScope],
			entityId,
			[Permission.START_MEETING, Permission.JOIN_MEETING],
			Actions.read
		);

		if (await permissionMap.get(Permission.START_MEETING)) {
			return BBBRole.MODERATOR;
		}
		if (await permissionMap.get(Permission.JOIN_MEETING)) {
			return BBBRole.VIEWER;
		}
		throw new ForbiddenException(&#x27;insufficient permission&#x27;);
	}

	/**
	 * Throws an error if the feature is disabled for the school or for the entire instance.
	 * @param {EntityId} schoolId
	 * @throws {ForbiddenException}
	 */
	protected async throwOnFeaturesDisabled(schoolId: EntityId): Promise&lt;void&gt; {
		// throw, if the feature has not been enabled
		if (!Configuration.get(&#x27;FEATURE_VIDEOCONFERENCE_ENABLED&#x27;)) {
			throw new ForbiddenException(&#x27;feature FEATURE_VIDEOCONFERENCE_ENABLED is disabled&#x27;);
		}
		// throw, if the current users school does not have the feature enabled
		const schoolFeatureEnabled &#x3D; await this.schoolUc.hasFeature(schoolId, SchoolFeatures.VIDEOCONFERENCE);
		if (!schoolFeatureEnabled) {
			throw new ForbiddenException(&#x27;school feature VIDEOCONFERENCE is disabled&#x27;);
		}
	}

	private static sanitizeString(text: string) {
		return text.replace(/[^\dA-Za-zÀ-ÖØ-öø-ÿ.\-&#x3D;_&#x60;´ ]/g, &#x27;&#x27;);
	}
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'VideoConferenceUc.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
